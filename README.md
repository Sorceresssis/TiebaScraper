# TiebaScraper

è´´å§çš„æ•°æ®çˆ¬å–å·¥å…·ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿ç•™åŸå§‹å†…å®¹ã€‚å¹¶ä¸”æ”¯æŒå¯¹å›¾ç‰‡ã€è§†é¢‘ã€è¯­éŸ³ç­‰åª’ä½“æ–‡ä»¶çš„ä¸‹è½½ã€‚

## TiebaReader

[TiebaReader](https://github.com/Sorceresssis/TiebaReader) æ˜¯ä¸æ­¤é¡¹ç›®å¯¹åº”çš„è´´å§é˜…è¯»å™¨é¡¹ç›®ã€‚çˆ¬å–çš„æ•°æ®å¯ä»¥ç”¨è¯¥å·¥å…·é˜…è¯»ã€‚ç‚¹å‡»è¯¥é¡¹ç›®çš„ Releases ä¸‹è½½ã€‚

## æ³¨æ„äº‹é¡¹

1. æœ‰æ—¶ç¬¬ä¸€æ¬¡è¿è¡Œä¼šå‡ºç°è¿æ¥é”™è¯¯ï¼Œå¤šè¯•å‡ æ¬¡å³å¯ã€‚
2. å·²ç»æ³¨é”€çš„ç”¨æˆ·ä¿å­˜çš„æ•°æ®ä¼šæœ‰ç¼ºå¤±ã€‚

## åŸºæœ¬ç”¨æ³•

### ä½¿ç”¨å¯æ‰§è¡Œç¨‹åº

#### å¼€å§‹

åœ¨ `releases` é‡Œä¸‹è½½æœ€æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åŒå‡»æ‰“å¼€å°±ä¼šå‡ºç°ä¸‹é¢çš„å‘½ä»¤è¡Œç•Œé¢ã€‚

ä½ å¯ä»¥é€šè¿‡æ–¹å‘é”®æ¥é€‰æ‹©ä½ æƒ³è¦è¿›è¡Œçš„æ“ä½œ(å°½ç®¡ç›®å‰å°±ä¸€ä¸ªåŠŸèƒ½ğŸ˜‚)ã€‚

![1724537635702](./assets/README/images/1724537635702.png)

#### é…ç½® BDUSS



è´´å§æœåŠ¡ç«¯ä½¿ç”¨ BDUSS æ¥ç¡®è®¤ç”¨æˆ·èº«ä»½

BDUSS æ˜¯ä¸€ä¸²ç”±çº¯ ascii å­—ç¬¦ç»„æˆçš„ï¼Œé•¿åº¦ä¸º 192 çš„å­—ç¬¦ä¸²

> **Warning**
>
> ä½¿ç”¨ BDUSS å¯ä»¥å®Œæˆ**ä¸€åˆ‡**ä¸éœ€è¦æ‰‹æœº/é‚®ç®±éªŒè¯ç çš„æ“ä½œï¼ŒåŒ…æ‹¬ **å‘å¸–** / **å‘ç§ä¿¡** /**è·å–è´¦å·ä¸Šçš„æ‰€æœ‰å†å²å‘è¨€**
>
> BDUSS çš„è¿‡æœŸæ—¶é—´é•¿è¾¾æ•°å¹´ï¼Œä¸€èˆ¬åªèƒ½é€šè¿‡é€€å‡ºç™»å½•æˆ–ä¿®æ”¹å¯†ç ä½¿å…¶å¤±æ•ˆ
>
> å› æ­¤å°† BDUSS æ³„éœ²ç»™ä¸å—ä¿¡ä»»çš„äººå¯èƒ½å¯¼è‡´é•¿æœŸçš„è´¦å·å®‰å…¨é£é™©å’Œéšç§æ³„éœ²é£é™©

åœ¨æµè§ˆå™¨çš„ Cookie å’Œå„ç§è¡¨å•å‚æ•°ä¸­ä½ éƒ½èƒ½çœ‹åˆ°å®ƒçš„èº«å½±

æœç´¢ ä½ çš„æµè§ˆå™¨å‹å·+å¦‚ä½•æŸ¥çœ‹ç½‘ç«™çš„ Cookie å°±èƒ½çŸ¥é“å¦‚ä½•è·å–ä½ çš„è´´å§è´¦å·çš„ BDUSS äº†

ä»¥ Chrome ä¸ºä¾‹ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªè´´å§ç½‘é¡µä¸‹æŒ‰ ã€ F12 ã€‘ è°ƒå‡ºå¼€å‘è€…é€‰é¡¹ï¼Œç„¶åä½ å°±èƒ½åœ¨ä¸‹å›¾çš„ä½ç½®æ‰¾åˆ°å®ƒ

![1718142431342](./docs/assets/README/images/1718142431342.png)





### å•Šå•Š

### å®‰è£…ä¾èµ–

python>=12.3

ä¸‹è½½å¹¶æ‰“å¼€é¡¹ç›®åï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–

```powershell
pip install -r requirements.txt
```

### é…ç½® BDUSS

è´´å§æœåŠ¡ç«¯ä½¿ç”¨ BDUSS æ¥ç¡®è®¤ç”¨æˆ·èº«ä»½

BDUSS æ˜¯ä¸€ä¸²ç”±çº¯ ascii å­—ç¬¦ç»„æˆçš„ï¼Œé•¿åº¦ä¸º 192 çš„å­—ç¬¦ä¸²

> **Warning**
>
> ä½¿ç”¨ BDUSS å¯ä»¥å®Œæˆ**ä¸€åˆ‡**ä¸éœ€è¦æ‰‹æœº/é‚®ç®±éªŒè¯ç çš„æ“ä½œï¼ŒåŒ…æ‹¬ **å‘å¸–** / **å‘ç§ä¿¡** /**è·å–è´¦å·ä¸Šçš„æ‰€æœ‰å†å²å‘è¨€**
>
> BDUSS çš„è¿‡æœŸæ—¶é—´é•¿è¾¾æ•°å¹´ï¼Œä¸€èˆ¬åªèƒ½é€šè¿‡é€€å‡ºç™»å½•æˆ–ä¿®æ”¹å¯†ç ä½¿å…¶å¤±æ•ˆ
>
> å› æ­¤å°† BDUSS æ³„éœ²ç»™ä¸å—ä¿¡ä»»çš„äººå¯èƒ½å¯¼è‡´é•¿æœŸçš„è´¦å·å®‰å…¨é£é™©å’Œéšç§æ³„éœ²é£é™©

åœ¨æµè§ˆå™¨çš„ Cookie å’Œå„ç§è¡¨å•å‚æ•°ä¸­ä½ éƒ½èƒ½çœ‹åˆ°å®ƒçš„èº«å½±

æœç´¢ ä½ çš„æµè§ˆå™¨å‹å·+å¦‚ä½•æŸ¥çœ‹ç½‘ç«™çš„ Cookie å°±èƒ½çŸ¥é“å¦‚ä½•è·å–ä½ çš„è´´å§è´¦å·çš„ BDUSS äº†

ä»¥ Chrome ä¸ºä¾‹ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªè´´å§ç½‘é¡µä¸‹æŒ‰ ã€ F12 ã€‘ è°ƒå‡ºå¼€å‘è€…é€‰é¡¹ï¼Œç„¶åä½ å°±èƒ½åœ¨ä¸‹å›¾çš„ä½ç½®æ‰¾åˆ°å®ƒ

![1718142431342](./docs/assets/README/images/1718142431342.png)

æŠŠå¤åˆ¶åˆ°çš„å€¼å¡«å†™åˆ° `/src/tieba_auth.py` ä¸­ã€‚ç”¨ `""`åŒ…è£¹åèµ‹å€¼ç»™ BDUSS å˜é‡å³å¯

![1721379368283](./docs/assets/README/images/1721379368283.png)

### è·å–å¸–å­çš„ tid

tid ç±»ä¼¼äºå¸–å­çš„èº«ä»½è¯ã€‚ä½ å¯ä»¥ä»å¸–å­çš„ url ä¸­è·å–åˆ°å®ƒ

ä¾‹å¦‚ ï¼š`https://tieba.baidu.com/p/8173224373?share=9105` è¿™ä¸ªå¸–å­çš„ tid å°±æ˜¯ `8173224373` , `?` åé¢çš„æ–‡å­—éƒ½æ— å…³ç´§è¦ã€‚

ç§»åŠ¨ç«¯å¯ä»¥é€šè¿‡åˆ†äº«å¸–å­ç„¶åå¤åˆ¶é“¾æ¥è·å– url

### å¼€å§‹æŠ“å–

æ–¹æ³•ä¸€: åœ¨ `terminal` è¾“å…¥ `python ./src/main.py` è¿è¡Œç¨‹åº, ç„¶åæ ¹æ®æç¤ºè¾“å…¥ç›¸å…³ä¿¡æ¯å³å¯ã€‚é€‚ç”¨ä»»ä½•ç¼–è¾‘å™¨ã€‚

æ–¹æ³•äºŒ: æ‰“å¼€ `/src/scrape.py` ç‚¹å‡»ä¾§è¾¹çš„è¿è¡ŒæŒ‰é’®ã€‚

![1721525837787](./docs/assets/README/images/1721525837787.png)

ç­‰å¾…æŠ“å–å®Œæˆã€‚æ•°æ®ä¿å­˜åœ¨å·¥ä½œç›®å½•ä¸‹çš„ `scraped_data` æ–‡ä»¶å¤¹é‡Œã€‚

ä¸‹é¢æµ‹è¯•(ä¸‹è½½é«˜æ¸…ç”¨æˆ·å¤´åƒ) `6071259325` : `ã€å§åŠ¡è´´ã€‘å¤§Bå§ä¸¾æŠ¥ç”³è¯‰æ¥¼` ã€‚

å›å¤æ•°é‡: `18377` æ¡ï¼Œæ–‡ä»¶æ•°é‡: `6,419` , æ•°æ®å¤§å°: `1.22GB (1,315,974,348 å­—èŠ‚)` ã€‚

è€—æ—¶ `4åˆ†26.29ç§’` ã€‚

![1721526660657](./docs/assets/README/images/1721526660657.png)

## Docs

[è´´å§æ•°æ® Note](./docs/tieba_data_notes.md)

[è´´å§å®˜æ–¹é”™è¯¯è¯´æ˜](./docs/tieba_error_desc.md)

[æ•°æ®åº“ DDL](./docs/SQL/DDL.sql)

## çˆ¬å–é…ç½®

æ–‡ä»¶ `/src/scrape_config.py` ä¸­ä¿å­˜äº†å…¨éƒ¨çš„çˆ¬å–é…ç½®ã€‚

### ç”¨æˆ·å¤´åƒæ¸…æ™°åº¦

`DOWNLOAD_USER_AVATAR_MODE` å¯ä»¥é…ç½®ç”¨æˆ·å¤´åƒä¸‹è½½æ¨¡å¼ï¼š

```python
# å¤´åƒä¸‹è½½æ¨¡å¼ï¼Œ0: ä¸ä¸‹è½½å¤´åƒ, 1: ä¸‹è½½ä½æ¸…å¤´åƒ, 2: ä¸‹è½½é«˜æ¸…å¤´åƒ
```

**ä½æ¸…å¤´åƒæ ·ä¾‹**

![1720768108538](./docs/assets/README/images/1720768108538.jpg)

**é«˜æ¸…å¤´åƒæ ·ä¾‹**

![1720768116148](./docs/assets/README/images/1720768116148.jpg)

### æ˜¯å¦ä¿å­˜è½¬å‘è´´

`SCRAPE_SHARE_ORIGIN` å˜é‡å¯ä»¥é…ç½®æ˜¯å¦ä¿å­˜è½¬å‘è´´ã€‚

å¦‚æœæ˜¯ `False` å°±åªä¿å­˜è½¬å‘è´´çš„ç¬¬ä¸€æ¥¼ã€‚

## æ•°æ®ä¿å­˜çš„ç›®å½•ç»“æ„

çˆ¬å–çš„æ•°æ®ä¿å­˜åœ¨å·¥ä½œç›®å½•ä¸‹çš„ `scraped_data` æ–‡ä»¶å¤¹é‡Œã€‚

`forum_name`: æŠ“å–è´´çš„å§å

`main_tid` : æŠ“å–è´´çš„ä¸»è´´ id

`thread_title` : å¤„ç†åçš„è´´æ ‡é¢˜

`timestamp` : æŠ“å–æ—¶é—´æˆ³

`share_origin_tid` : ä¸»è´´çš„è½¬å‘åŸå¸–çš„ tid(å¦‚æœå­˜åœ¨çš„è¯)

```powershell
[${forum_name}å§][${main_tid}]${thread_title}_${timestamp}
    â”œâ”€â”€â”€scrape_info.json # ä¿å­˜ä¸€äº›å…³äºæœ¬æ¬¡æŠ“å–çš„ä¿¡æ¯
    â””â”€â”€â”€threads
        â”œâ”€â”€â”€${main_tid}
        â”‚   â”œâ”€â”€â”€forum_avatar # å§çš„å¤´åƒ
        â”‚   â”œâ”€â”€â”€post_assets  # å¸–å­çš„åª’ä½“æ–‡ä»¶
        â”‚   â”‚   â”œâ”€â”€â”€images
        â”‚   â”‚   â”œâ”€â”€â”€videos
        â”‚   â”‚   â””â”€â”€â”€voices
        â”‚   â”œâ”€â”€â”€user_avatar # ç”¨æˆ·çš„å¤´åƒ
        â”‚   â”œâ”€â”€â”€content.db # å¸–å­å†…å®¹
        â”‚   â”œâ”€â”€â”€forum.json # å§ä¿¡æ¯
        â”‚   â”œâ”€â”€â”€scrape.log  # æŠ“å–çš„æ—¥å¿—
        â”‚   â”œâ”€â”€â”€thread.json # å¸–å­ä¿¡æ¯
        â”‚   â””â”€â”€â”€update_${timestamp}.log # æ›´æ–°æ—¥å¿—
        â””â”€â”€â”€${share_origin_tid} # ä¸»è´´çš„è½¬å‘åŸå¸–ï¼Œå¦‚æœå­˜åœ¨çš„è¯
            â”œâ”€â”€â”€forum_avatar
            â”œâ”€â”€â”€post_assets
            â”‚   â”œâ”€â”€â”€images
            â”‚   â”œâ”€â”€â”€videos
            â”‚   â””â”€â”€â”€voices
            â”œâ”€â”€â”€user_avatar
            â”œâ”€â”€â”€content.db
            â”œâ”€â”€â”€forum.json
            â”œâ”€â”€â”€scrape.log
            â”œâ”€â”€â”€thread.json
            â””â”€â”€â”€update_${timestamp}.log

```

## é¸£è°¢

æ„Ÿè°¢è¿™äº›é¡¹ç›®ä½œè€…çš„å¸®åŠ©ã€‚

- [Starry-OvO/aiotieba: Asynchronous I/O Client for Baidu Tieba](https://github.com/Starry-OvO/aiotieba)
- [n0099/tbclient.protobuf: ç™¾åº¦è´´å§å®¢æˆ·ç«¯ Protocol Buffers å®šä¹‰æ–‡ä»¶åˆé›†](https://github.com/n0099/tbclient.protobuf)
